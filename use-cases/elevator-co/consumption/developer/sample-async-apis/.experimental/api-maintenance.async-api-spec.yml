---
components:
  schemas:
    maintenance:
      "$schema": http://json-schema.org/draft-07/schema#
      type: object
      title: Elevator Co maintenance event payload
      required:
      - header
      - body
      properties:
        header:
          additionalProperties: false
          type: object
          required:
          - topic
          - timestamp
          - tracking_id
          properties:
            topic:
              type: string
            timestamp:
              type: string
            tracking_id:
              type: string
              pattern: "^[a-zA-Z0-9-]+$"
        body:
          additionalProperties: false
          type: object
          required:
          - component_id
          - description
          - timewindow_days
          - details
          properties:
            component_id:
              title: component_id that needs maintenance
              type: string
            timewindow_days:
              title: maintenance time window in days
              type: integer
            description:
              title: maintenance description
              type: string
            details:
              title: maintenance details
              type: object
            probability_of_failure_pct:
              title: probability of fault / urgency of maintenace in %
              type: integer
      "$id": http://eventportal.solace.cloud/apim/elevator-co/maintenance/maintenance.json
  messages:
    maintenance:
      payload:
        "$ref": "#/components/schemas/maintenance"
      schemaFormat: application/vnd.aai.asyncapi+json;version=2.0.0
      contentType: application/json
      examples:
      - payload:
          header:
            topic: apim/elevator-co/api/V1/json/fr/elevator/maintenace/elev-make-1/elevator-id-1
            timestamp: 2021-02-15-13:25:27-UTC
            tracking_id: 4fd44ed1-1ba9-4f53-87a2-d4f4385c09d5
          body:
            component_id: ABC-1784
            description: misalignment car to floor
            timewindow_days: 24
            probability_of_failure_pct: 90
            details:
              reasons:
              - misalignment car to floor > 8mm
              - avg journeys / day > 25
  parameters:
    resource_region_id:
      schema:
        type: string
        enum:
        - fr
        - de
    equipment_type:
      schema:
        type: string
        enum:
        - elevator
    event_type:
      schema:
        type: string
        enum:
        - maintenace
    resource_type:
      schema:
        type: string
        enum:
        - elev-make-1
        - elev-make-2
    resource_id:
      schema:
        type: string
        pattern: "^[a-zA-Z0-9-]+$"
  securitySchemes:
    userPassword:
      type: userPassword
      description: Username Password
    httpBasic:
      type: http
      description: HTTP Basic
      scheme: basic
channels:
  apim/elevator-co/api/V1/json/{resource_region_id}/{equipment_type}/{event_type}/{resource_type}/{resource_id}:
    publish:
      summary: receive maintenace events from elevators
      description: |
        Maintenance events indicate recommended maintenance actions to be carried out within a certain timeframe.
        Each maintennace event must be confirmed with a status_update message using the same tracking_id indicating action is either received or resolved.
      operationId: onMaintenance
      bindings:
        mqtt:
          bindingVersion: "‘0.2.0’"
          qos: 1
          permissions:
            topics:
              - "apim/elevator-co/api/V1/json/fr/+/+/+/#"
        http:
          bindingVersion: "‘0.1.0’"
          type: request
          method: POST
      message:
        "$ref": "#/components/messages/maintenance"
    parameters:
      resource_region_id:
        "$ref": "#/components/parameters/resource_region_id"
      equipment_type:
        "$ref": "#/components/parameters/equipment_type"
      event_type:
        "$ref": "#/components/parameters/event_type"
      resource_type:
        "$ref": "#/components/parameters/resource_type"
      resource_id:
        "$ref": "#/components/parameters/resource_id"
asyncapi: 2.0.0
info:
  x-application-class: unspecified
  title: ApiEventService:maintenance
  x-view: consumer
  version: 0.0.3
servers:
  dev-ws-mqtt:
    protocol: ws-mqtt
    url: ws://mr1i5g7tif6z9h.messaging.solace.cloud:8000
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  dev-wss-mqtt:
    protocol: wss-mqtt
    url: wss://mr1i5g7tif6z9h.messaging.solace.cloud:8443
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  dev-secure-mqtt:
    protocol: secure-mqtt
    url: ssl://mr1i5g7tif6z9h.messaging.solace.cloud:8883
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  dev-mqtt:
    protocol: mqtt
    url: tcp://mr1i5g7tif6z9h.messaging.solace.cloud:1883
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  dev-http:
    protocol: http
    url: http://mr1i5g7tif6z9h.messaging.solace.cloud:9000
    security:
    - httpBasic: []
  prod-ws-mqtt:
    protocol: ws-mqtt
    url: ws://mr1n34cqfgy8kj.messaging.solace.cloud:8000
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  prod-wss-mqtt:
    protocol: wss-mqtt
    url: wss://mr1n34cqfgy8kj.messaging.solace.cloud:8443
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  prod-secure-mqtt:
    protocol: secure-mqtt
    url: ssl://mr1n34cqfgy8kj.messaging.solace.cloud:8883
    security:
    - userPassword: []
  prod-mqtt:
    protocol: mqtt
    url: tcp://mr1n34cqfgy8kj.messaging.solace.cloud:1883
    security:
    - userPassword: []
    bindings:
      mqtt:
        clientId: "{consumerKey}"
        cleanSession: false
        connectTimeout: 60
        keepAlive: 60
        lastWill:
          topic: apim/elevator-co/api/last-will
          qos: 1
          message: gone offline.
          retain: false
        bindingVersion: 0.2.0
  prod-http:
    protocol: http
    url: http://mr1n34cqfgy8kj.messaging.solace.cloud:9000
    security:
    - httpBasic: []
