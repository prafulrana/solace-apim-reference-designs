components:
  schemas:
    fault:
      $schema: 'http://json-schema.org/draft-07/schema#'
      type: object
      title: Elevator Co fault event payload
      required:
        - header
        - body
      properties:
        header:
          additionalProperties: false
          type: object
          required:
            - topic
            - timestamp
          properties:
            topic:
              type: string
            timestamp:
              description: >-
                the time the fault was generated by the asset - includes the
                timezone
              type: string
        body:
          additionalProperties: false
          type: object
          required:
            - type
            - description
            - code
            - details
          properties:
            component_id:
              title: component_id the fault refers to
              type: string
            code:
              title: alarm code
              type: integer
            description:
              title: human readable fault description
              type: string
            details:
              anyOf:
                - additionalProperties: false
                  title: details for type=light
                  type: object
                  required:
                    - actual_lux
                    - expected_lux
                    - discrepancy_pct
                  properties:
                    expected_lux:
                      type: integer
                    discrepancy_pct:
                      type: integer
                    actual_lux:
                      type: integer
                - additionalProperties: false
                  title: details for type=phone
                  type: object
                  required:
                    - num_tests_failed
                  properties:
                    num_tests_failed:
                      type: integer
              title: alarm or fault details
              type: object
            type:
              title: the type of alarm
              type: string
              enum:
                - light
                - phone
      $id: 'http://eventportal.solace.cloud/apim/elevator-co/alarm.json'
    critical-alarm:
      $schema: 'http://json-schema.org/draft-07/schema#'
      type: object
      title: Elevator Co critical alarm event payload
      required:
        - header
        - body
      properties:
        header:
          additionalProperties: false
          type: object
          required:
            - topic
            - timestamp
          properties:
            topic:
              type: string
            timestamp:
              description: >-
                the time the alarm was generated by the asset - includes the
                timezone
              type: string
        body:
          additionalProperties: false
          type: object
          required:
            - type
            - description
            - code
            - details
          properties:
            code:
              title: alarm code
              type: integer
            description:
              title: human readable alarm description
              type: string
            details:
              anyOf:
                - additionalProperties: false
                  title: details for type=car2floor_alignment
                  type: object
                  required:
                    - floor
                    - discrepancy_mm
                  properties:
                    discrepancy_mm:
                      type: integer
                    floor:
                      type: integer
                - additionalProperties: false
                  title: details for type=max_weight_exceeded
                  type: object
                  required:
                    - max_weight_kg
                    - actual_weight_kg
                  properties:
                    actual_weight_kg:
                      type: integer
                    max_weight_kg:
                      type: integer
              title: alarm or fault details
              type: object
            type:
              title: the type of alarm
              type: string
              enum:
                - car2floor_alignment
                - max_weight_exceeded
      $id: 'http://eventportal.solace.cloud/apim/elevator-co/alarm.json'
  messages:
    fault:
      payload:
        $ref: '#/components/schemas/fault'
      schemaFormat: application/vnd.aai.asyncapi+json;version=2.0.0
      contentType: application/json
    critical-alarm:
      payload:
        $ref: '#/components/schemas/critical-alarm'
      schemaFormat: application/vnd.aai.asyncapi+json;version=2.0.0
      contentType: application/json
  parameters:
    topic_elem:
      schema:
        type: string
channels:
  'apim/elevator-co/data-product/V1/json/elevator/critical-alarm/{resource_org_id}/{resource_region_id}/{resource_sub_region_id}/{resource_site_id}/{resource_type}/{resource_id}':
    subscribe:
      message:
        $ref: '#/components/messages/critical-alarm'
    parameters:
      resource_org_id:
        $ref: '#/components/parameters/topic_elem'
      resource_region_id:
        $ref: '#/components/parameters/topic_elem'
      resource_sub_region_id:
        $ref: '#/components/parameters/topic_elem'
      resource_site_id:
        $ref: '#/components/parameters/topic_elem'
      resource_type:
        $ref: '#/components/parameters/topic_elem'
      resource_id:
        $ref: '#/components/parameters/topic_elem'
  'apim/elevator-co/data-product/V1/json/elevator/fault/{resource_org_id}/{resource_region_id}/{resource_sub_region_id}/{resource_site_id}/{resource_type}/{resource_id}':
    subscribe:
      message:
        $ref: '#/components/messages/fault'
    parameters:
      resource_org_id:
        $ref: '#/components/parameters/topic_elem'
      resource_region_id:
        $ref: '#/components/parameters/topic_elem'
      resource_sub_region_id:
        $ref: '#/components/parameters/topic_elem'
      resource_site_id:
        $ref: '#/components/parameters/topic_elem'
      resource_type:
        $ref: '#/components/parameters/topic_elem'
      resource_id:
        $ref: '#/components/parameters/topic_elem'
asyncapi: 2.0.0
info:
  x-application-class: unspecified
  title: alarms-and-faults
  x-view: provider
  version: 0.0.1
